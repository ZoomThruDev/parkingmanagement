<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>VIOLATIONS TOWING</title>
<link href='https://fonts.googleapis.com/css?family=Roboto:400,100italic,300,100,300italic,400italic,500,500italic,700,700italic,900italic,900' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="../style.css">
</head>

<script type="text/javascript" src="../js/jquery.js"></script>
<script type="text/javascript" src="../js/validate.js"></script>
<!--<script type="text/javascript" src="../js/congig2.js"></script>-->
<script type="text/javascript">


function gup( name, url ) {
  if (!url) url = location.href;
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( url );
  return results == null ? '' : results[1];
}
function language_en_menus()
{
	var menu='<div class="lang_div"><ul><li class="active"><a href="#">English</a></li><li><a href="#">Espanol</a></li></ul></div>';
	return menu;
}
function driver_menus(para='')
{
	var menu='<li><a href="violations-towing.html'+para+'">Violation Towing</a></li>';
		menu+='<li><a href="unauthorized-vehicles.html'+para+'">Unauthorized Vehicles</a></li>';
		menu+='<li><a href="inactive-vehicles.html'+para+'">Inactive Vehicles</a></li>';
		menu+='<li><a href="my-account.html'+para+'">My Account</a></li>';
		menu+='<li><a href="../index.html">Log Out</a></li>';
	return menu;
}
function manager_menus(para='')
{
	var menu='<li><a href="vehicles.html'+para+'">Vehicles</a></li>';
		menu+='<li><a href="violations-towing.html'+para+'">Violation Towing</a></li>';
		menu+='<li><a href="unauthorized-vehicles.html'+para+'">Unauthorized Vehicles</a></li>';
		menu+='<li><a href="users.html'+para+'">Users</a></li>';
		menu+='<li><a href="my-account.html'+para+'">My Account</a></li>';
		menu+='<li><a href="../index.html">Log Out</a></li>';
	return menu;
}


var uid=gup('uid', window.location.href);

var usertype=gup('usertype', window.location.href);
setTimeout(function(){
	
	if(usertype=='driver')
	{
		jQuery('.driver').show();
		var menu=driver_menus('?uid='+uid+'&usertype='+usertype);
		jQuery('.menu_div ul.menus').html(menu);
		jQuery('.logo_div a').attr('href','dashboard.html?uid='+uid+'&usertype='+usertype);
	}
	if(usertype=='admin')
	{
		jQuery('.admin').show();
		var menu=manager_menus('?uid='+uid+'&usertype='+usertype);
		jQuery('.menu_div ul.menus').html(menu);
		jQuery('.logo_div a').attr('href','dashboard.html?uid='+uid+'&usertype='+usertype);
	}
	jQuery('a.showhidemenus').click(function(){
		if(jQuery(this).hasClass('show'))
		{
			jQuery( ".menu_div ul.menus").animate({ "left": "-220px" }, "slow" );
			jQuery(this).removeClass('show');
		}
		else
		{
			jQuery( ".menu_div ul.menus").animate({ "left": "0px" }, "slow" );
			jQuery(this).addClass('show');
		}
	});
},500);
function checkloggedin(uid,siteurl)
{
	
	var url=siteurl+'/api/login';
	
	jQuery.ajax({  
	 type: 'POST',  
	 url: url,  
	 //contentType: contentType,  
	 dataType: 'json',  
	 data: {checkloggedin:1,uid:uid},  
	 crossDomain: true,  
	 beforeSend: function() {
		jQuery('body .bodyoverlay').remove();
		jQuery('body .preloader').remove();
		var html='<div class="bodyoverlay"></div><div class="preloader"></div>';
		jQuery('body').append(html);					
	 },		
	 complete: function() {
		jQuery('body .bodyoverlay').remove();
		jQuery('body .preloader').remove();					
	 },
	 success: function(res) {  
	   if(res['loggedin']!='success')
	   {
		window.location='../index.html';   
	   }
		return false;
	 },  
	 error: function(response, d, a){
		jQuery('body .bodyoverlay').remove();
		jQuery('body .popupbox').remove();
		var html='<div class="bodyoverlay"></div><div class="popupbox errorbox"><div class="popupimg"><img src="../images/error.png" /></div><h1 class="success">ERROR</h1><h1>Server Error.</h1><button class="okbox">OK</button></div>';
		jQuery('body').append(html);
		
		jQuery('.okbox').click(function(){
			jQuery('body .bodyoverlay').remove();
			jQuery('body .popupbox').remove();
		}); 
		
	 } 
   });
		
}



jQuery(document).ready(function(){
	
	jQuery( document ).on( "mobileinit", function() {
		jQuery.mobile.allowCrossDomainPages = true;
	});
	var contentType ="application/x-www-form-urlencoded; charset=utf-8";
    if(window.XDomainRequest){contentType = "text/plain";}
	jQuery.support.cors = true;
	
	var siteurl = "http://parkingandtowingexperts.com/parkingmanagement/app";
	var realsiteurl = "http://parkingandtowingexperts.com/parkingmanagement";
	
	var url=siteurl+'/api/myaccount';
    
	var uid=gup('uid', window.location.href);
	checkloggedin(uid,siteurl);
	var usertype=gup('usertype', window.location.href);
	
	jQuery.ajax({  
         type: 'POST',  
         url: url,  
         //contentType: contentType,  
         dataType: 'json',  
         data: {uid:uid},  
         crossDomain: true,  
		 beforeSend: function() {
			jQuery('body .bodyoverlay').remove();
			jQuery('body .preloader').remove();
			var html='<div class="bodyoverlay"></div><div class="preloader"></div>';
			jQuery('body').append(html);					
		 },		
		 complete: function() {
			jQuery('body .bodyoverlay').remove();
			jQuery('body .preloader').remove();					
		 },
         success: function(res) {  
		 	alert('success');
		 	jQuery('#company_name').val(res['user']['detail']['company_name']);
			jQuery('#name').val(res['user']['detail']['name']);
			jQuery('#email').val(res['user']['detail']['email']);
			jQuery('#phone').val(res['user']['detail']['phone']);
			jQuery('#Address').val(res['user']['detail']['Address']);
			jQuery('#username').val(res['user']['detail']['username']);
			jQuery('#notes').val(res['user']['detail']['notes']);
			jQuery('#tdlr').val(res['user']['detail']['tdlr']);
         },  
         error: function(response, d, a){
            jQuery('body .bodyoverlay').remove();
			jQuery('body .popupbox').remove();
			var html='<div class="bodyoverlay"></div><div class="popupbox errorbox"><div class="popupimg"><img src="../images/error.png" /></div><h1 class="success">ERROR</h1><h1>Server Error.</h1><button class="okbox">OK</button></div>';
			jQuery('body').append(html);
			
			jQuery('.okbox').click(function(){
				jQuery('body .bodyoverlay').remove();
				jQuery('body .popupbox').remove();
			}); 
         } 
       });
	  jQuery('#edituser').validate();
	 jQuery('#edituser').submit(function(){
	 	var company_name=jQuery('#company_name').val();
		var name=jQuery('#name').val();
		var email=jQuery('#email').val();
		var phone=jQuery('#phone').val();
		var Address=jQuery('#Address').val();
		var username=jQuery('#username').val();
		var notes=jQuery('#notes').val();
		var tdlr=jQuery('#tdlr').val();
		var pwd=jQuery('#pwd').val();
		
		var error=false;
		jQuery('#edituser input, #edituser textarea').each(function(){
			if(jQuery(this).hasClass('error'))
			{
				error=true;
			}
		});
		if(!error)
		{
			jQuery.ajax({  
			 type: 'POST',  
			 url: url,  
			 dataType: 'json',  
			 data: {uid:uid, company_name:company_name, name:name, email:email, phone:phone, Address:Address, username:username, notes:notes, tdlr:tdlr, pwd:pwd},  
			 crossDomain: true,  
			 beforeSend: function() {
				jQuery('body .bodyoverlay').remove();
				jQuery('body .preloader').remove();
				var html='<div class="bodyoverlay"></div><div class="preloader"></div>';
				jQuery('body').append(html);					
			 },		
			 complete: function() {
				//jQuery('body .bodyoverlay').remove();
				jQuery('body .preloader').remove();					
			 },
			 success: function(res) {  
				if(res['user']['error'])
				{
					jQuery('body .bodyoverlay').remove();
					jQuery('body .popupbox').remove();
					var html='<div class="bodyoverlay"></div><div class="popupbox errorbox"><div class="popupimg"><img src="../images/error.png" /></div><h1 class="success">ERROR</h1><h1>'+res['user']['error']+'</h1><button class="okbox">OK</button></div>';
					jQuery('body').append(html);
					
				}
				else if(res['user']['update'])
				{
					jQuery('body .bodyoverlay').remove();
					jQuery('body .popupbox').remove();
					var html='<div class="bodyoverlay"></div><div class="popupbox"><div class="popupimg"><img src="../images/pop.png" /></div><h1 class="success">SUCCESS</h1><h1>Account Update Successfully.</h1><button class="okbox">OK</button></div>';
					jQuery('body').append(html);
					
				}
				jQuery('.okbox').click(function(){
					jQuery('body .bodyoverlay').remove();
					jQuery('body .popupbox').remove();
				}); 
				return false;
			 },  
			 error: function(response, d, a){
				jQuery('body .bodyoverlay').remove();
				jQuery('body .popupbox').remove();
				var html='<div class="bodyoverlay"></div><div class="popupbox errorbox"><div class="popupimg"><img src="../images/error.png" /></div><h1 class="success">ERROR</h1><h1>Server Error.</h1><button class="okbox">OK</button></div>';
				jQuery('body').append(html);
				
				jQuery('.okbox').click(function(){
					jQuery('body .bodyoverlay').remove();
					jQuery('body .popupbox').remove();
				}); 
			 } 
		   });
	   }
	   return false;
	 });
});		
</script>
<body>
<div class="wrapper">
	<div class="container">
		<header>
			<div class="menu_div"><!----------------------menu startss-------------------------------------->
			<a href="javascript:;" class="showhidemenus"><img src="../images/menu32@64.png"></a>
			<ul class="menus"></ul>
			</div>
			<script type="text/javascript">document.write(language_en_menus());</script>
				<div class="logo_div">
					<a href="#"><img src="../images/logo.png"></a>
				</div>
		</header><!------------------header close-------------------------------->
		<!--------------------------content-div starts------------------------------------------->	
			<div class="content_div manager_search">
				
				<div class="inner_content"><!--------------------------inner_content------------------------------------------->
					<h4 class="search_headng">My Account</h4>
						 
					      <div class="select_div">
						  <form name="edituser" id="edituser" action="" method="post">
							<div class="admin field"> Company Name
							<input type="text" class="form-control required" placeholder="Company Name" id="company_name" name="company_name" value="">
							</div>
							<div class="field">Name
							  <input type="text" id="name" value="" placeholder="Name" class="form-control required" name="name">
							</div>
							<div class="field"> Email
							  <input type="text" id="email" value="" placeholder="Email" class="form-control required email" name="email">
							</div>
							<div class="field"> 
								Phone
							  <input type="text" class="form-control required" value="" id="phone" placeholder="Phone" name="phone">
							</div>
							<div class="admin field">
							Address
							<input type="text" class="form-control" id="Address" placeholder="Address" name="Address" value="">
							</div>
							<div class="field">
							Username
							  <input type="text" class="form-control required" id="username" placeholder="Username" value="" disabled="disabled">
							</div>
							<div class="field">
								Password
							  <input type="password" class="form-control" id="pwd" placeholder="Password" name="pwd">
							</div>
							<div class="admin userf field">
								Note
							  <textarea  class="form-control" placeholder="Notes" id="notes"  name="notes"></textarea>
							</div>
							
							<div class="driver field"> 
							  <input type="text" class="form-control" id="tdlr" placeholder="Driver TDLR#" value="" name="tdlr">
							</div>
							<div class="clr"></div>
							<button class="btn btn-success" name="update" type="submit">Update</button>
						  </form>
					   </div>
							
				</div><!--------------------------inner_content------------------------------------------->	
				</div>.
			</div>
		
		<!--------------------------content-div endss------------------------------------------->	
	</div>
</div>

</body>
</html>

